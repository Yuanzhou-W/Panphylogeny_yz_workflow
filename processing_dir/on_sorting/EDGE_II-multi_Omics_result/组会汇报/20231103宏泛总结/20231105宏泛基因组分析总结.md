# 环境中蓝细菌基因组学研究方法文献总结

# 原绿球藻进化理论文献总结

# 工作计划
[[工作计划]]
# 原绿球藻分析工作总结

## 基因组特征分析
### 基于checkm的各生态型特征总结
[[Q1-关于checkm的marker]]
1. AMZ 生态型的marker 明显不同于其他生态型
               ![[Pasted image 20230929200100.png]]
   解释：
       - AMZ 生态型中的完整度在多种方法下都普遍较低，作为计算依据的marker自然也显著低
       - AMZ 生态型由于生境显著与其他生态型显著不同，在进化中，尽管在GTDB的117个marker集中被划分为原绿球藻，但其marker已经显著不同于原绿球藻
   但考虑到acdc去污染后的AMZ生态型的文件大小都较大，所以本人更倾向于用第二种方式解释


### GTDB-tk 方法的种内进化分析不适用性
1. 问题：GTDB建树的结果中，多个数据集下都体现出LLI作为HL和LL的过渡型，而不是iqtree中体现的LLIILLIII
2. 猜想：
  - 117个marker的比对结果造成，这117个marker不适合于原绿球藻
  - fasttree建树方法造成
3. 验证：
   对于泛基因组和GTDB的比对文件分别使用fasttree和iqtree建树
4. 结果：
   除了  iqtree+pangenome  的结果为LLIILLIII作为过渡生态型，其余建树都不体现这点
5. 解释：
   - GTDB在原绿球藻分类学研究上的分辨率只到生态型与种之间，能较好的划分生态型，但是不能准确体现生态型之间的进化关系
   - iqtree在两种比对结果中，在亚生态型划分上有更好的性能，相比于fasttree的结果中的零碎的subclade，iqtree中明显划分出相对关系较为明显的亚生态型
   - iqtree在模型选择和解释上都优于fasttree，并提供了有研究意义的结果

## 原绿球藻基因组学分析
### 基于 anvio 进行的泛基因组相关分析
#### 基因簇泛基因组
[[stage_II_20230928/报告/20231103宏泛总结/泛基因组分析]]
##### 基于单拷贝基因的系统发育学分析
![[Pasted image 20231105185122.png]]
1. 方法：
   a. 由 mOTUlizer 计算出核心区(Core)与附属区(ACCESSARY)
   b. 在 CORE 区域选择 60%~75% (参考orthofinder) 的 约 100~300簇(参考GTDB) 单拷贝簇
   c. 串联，使用iqtree建树

2. 结果
   a. 尽管实际使用的基因簇在不同分析意义中的基因组dataset中有部分差异，其生态型水平的相对进化关系，在完整度75及以下的dataset上有较好的可重复性。
   b. 从生物学解释和 anvio 课题组的相关论文结论上，基于同源簇的方法应当是更加适合于原绿球藻种内高分辨率划分的
   实际观察到，无论是iqtree或者fasttree，亚生态型相对进化关系的结果都比其他方法有更高的分辨率

3. 解释
   基于泛基因组的单拷贝核心簇比对 高分辨率解释了 亚生态型相对进化关系 -- 生态型内部划分更合理
   iqtree选取的Q.plant模型 在一定生物学意义上解释了 生态型相对进化关系 -- LLIILLIII作为HL和LL之间的过渡类群

##### 基因簇水平 频率/有无聚类分析
**说明**
这里由于anvio本身的问题，基因簇Counts表无法导出，故用orthofinder识别的同源基因信息表代替进行聚类分析

使用 spearman 计算correlation，使用 Complete 方法基于correlation矩阵建树

**聚类图像**
1. 基于同源组的有无 
   ![[04fb31f1-5e3e-4e92-b81b-f77433ed34ea.pheatmap.r]]
   ![[04fb31f1-5e3e-4e92-b81b-f77433ed34ea.pheatmap.pdf]]
   
2. 基于同源组的频率
   ![[04c96c9e-d346-43c5-90e8-dd09a4985b8d.pheatmap.r]]
   ![[04fb31f1-5e3e-4e92-b81b-f77433ed34ea.pheatmap 1.pdf]]
**分析**
1. LL型内部有较大分别，分为两大分支：LLIV+LLother、LLI+LLIILLIII；HL型内部的分别不大
2. LLI+LLIILLIII与HL聚类在更大的分支上，这可能预示了HL型的进化过程和原绿球藻流线型化的位置和次数
3. 在基于有无的聚类分析种，发现完整度大于90时，可能由于HLVI、HLVII、HLIII/IV/VI等被去冗余，以及LLIILLIII生态型中的完整基因组较少，所以体现出LLIILLIII与LLIV聚类在一起。
   - 这点在完整度大于75及以下的泛基因组分析中，均体现出LLII与LLI或者HL型聚类在一起
   
#### 功能泛基因组 - 完整度80水平
##### 功能水平 基因组聚类分析
1. 基于基因功能的有无
   LLIILLIII与LLI是一类，但是聚类关系上比LLI更加接近HL型
2. 基于基因功能的频率
   LLIILLIII与LLI是一类，聚类关系上LLI与HL更加接近
##### 功能富集分析
[Pasted image 20231104205534.png]
![[Pasted image 20231104205517.png]]

![[FUNC_OCCURENCE_STATS.txt]]

![[FUNC_ENRICHMENT_OUTPUT.txt]]

[[HL、LLI、LLIILLIII泛基因组功能富集分析]]
###### 富集基因功能分类
1. HL、LLI  -  表层、高温适应相关基因
   a. HL、LLI - 源于环境或者流线型化共同祖先
   - PSII系统质醌氧化还原酶psbM，更高效的光合系统
   - 硝基还原酶Nitroreductase Family
   - 渗透调节相关转运体家族urtC蛋白
   b. HL、LLI、LLIV - 源于祖先或者再获得
   - N吸收相关Nitroreductase Family
   - 转运细胞内废物相关转运蛋白Multidrug Efflux ABC Transporter
2. LLIILLIII、LLI  -  深层、低温适应相关基因
   a. LLIILLIII、LLI - 源于环境或者流线型化共同祖先
   - DNA修复相关：DNA Helicase Related to Phage Enzyme，与噬菌体侵染相关
   - 光捕获蛋白Chlorophyll a b Binding Light Harvesting Protein PcbB
   - 胁迫相关谷胱甘肽合成相关蛋白
   b. LLIILLIII、LLI、LLIV - 源于祖先或者再获得
   - 高光诱导蛋白hli3、hli2、hli8
   - 梭体外壳蛋白carboxysome peptide B
   **- 噬菌体/病毒侵染相关蛋白pspA、COG0526、Viral (Superfamily 1) RNA Helicase**
   - DNA修复相关蛋白mutY(降解)、Cyanobacteria-Specific Protein Containing UvrC-Like Endonuclease Domai
   - 胁迫相关热休克蛋白DnaJ、分子伴侣ppiB
   - 渗透压调节-离子相关蛋白crcB1、Bacterial Type II Secretion System Protein、cutA
###### 分析
高温表层适应中，富集的基因多关注于无机N吸收，高效光合作用和转运系统

低温深层适应中，富集的基因多关注于响应噬菌体/病毒侵染，DNA修复，离子胁迫，低温胁迫
#### 流线型化推断
分析
   ![[Pasted image 20231104215519.png]]
   a. 关于流线型化的发生次数与位置
   ![[原绿球藻进化模式图.drawio]]
   [[原绿球藻类进化推断]]
   
   ![[Pasted image 20231105181559.png]]
    - LLIV与LLI之间: 
      将LLother认为一个干扰类群，可以看到，LLIV与LLI之间有明显的基因组特征差别，其后的进化过程中都在持续发生流线型化，但是都没有该处发生的基因组缩减程度大
    - LLI与LLIILLIII之间 - 2次
      观察到在LLI与LLIILLIII之间再基因数量上有明显的缩减，但这可能是因为LLI是一个具有广泛生境的生态型，通过HGT等形式获取了多了非垂直遗传基因，故而基因组大小较大。而LLIILLIII生态型相对来说具有较为固定的生态位，丢失了较多基因，进一步缩减了基因组大小。
      综上，该处的基因组流线型化相比LLIV与LLI之间并不清晰。
      
### geotrace数据库 宏基因组分析
geotrace项目 总航线图![[Pasted image 20231103220820.png]]
#### 丰度数据基本特征分析
[[geotrace数据库宏基因组丰度分析]]
说明 ：这里是将原绿球藻亚种基因组视作 OTUs/ASVs 所进行的差异丰度分析

##### 分析流程
![[Pasted image 20231102180459.png]]
##### 结论
1. geotrace的宏基因组样本环境分布特征
   以主要的四个采样区域做划分，有如下分布特征
   a. 本次搜库样本在深度、温度分布中均体现了较好的连续性分布
      ![[depth_QuantilePlot.pdf]]
      ![[temp_QuantilePlot.pdf]]
   b. 本次搜库样本在经度分布上，仅仅在 Pacific Ocean中有较好的连续分布
       ![[lon_QuantilePlot.pdf]]
   c. 本次搜库样本在纬度分布上，仅仅在 Atlantic Ocean中有较好的连续分布
       ![[lat_QuantilePlot.pdf]]

2. 丰度聚类与生态型之间的对应关系
   在丰度矩阵上使用 manhattan 算法计算距离矩阵，使用 complete 方法进行两轴聚类，结果呈现出个生态型都有较为对应的一组高质量样本。
   ![[Pasted image 20231102190958.png]]
   
   a. 生态型划分在丰度分布上有分析意义
   b. 可以借助该关系选择不同的clade对应的高质量样本进行更细致可信的分析
   
3. WGCNA分析方法下划分的原绿球藻种内调控网络
   a. 说明
    WGCNA本身是一种用于基因表达趋势蕨类并进行网络分析的方法，需要的数据基础是趋势，故而不对基因表达矩阵的标准话有较强的要求。 
    **类比** 基于基因芯片类型的差异基因表达的 limma 算法在 OTUs/ASVs 分析中可以直接用于差异株系丰度分析，故而这里将WGCNA也用于株系丰度分析
   
   b. 分析图像
	   ![[6b60e881-8ecf-44e7-b9c7-8dffbb917ce0.WGCNA_ModuleGeneTraitHeatmap.pdf]]
	   ![[6b60e881-8ecf-44e7-b9c7-8dffbb917ce0.WGCNA_moduleTraitHeatmap.pdf]]

   c. 结论 - 原绿球藻种内的六个调控网络
     各模块核心株系
		1. turquoise
		   HLII
		2. green
		   另一部分HLII
		3. yellow
		   HLI
		4. blue
		   LLother和LLIV
		5. brown
		   LLI
		6. red
		   LLIILLIII与HLVI
     这可能代表了原绿球藻广泛生境下，因为温盐深等环境因素长期分化，最终形成的六个主要的种内调控网络，也可能代表了不同地理位置的种内应对策略

#### 原绿球藻亚种水平环境相关丰度分析
##### 基于iqtree的亚生态型划分与丰度分析之间的相关性
需要热图，目前工作在高婕那里

1. 自作用图
   [O2Urb6azhYb5ujF6tKzEgg.pdf]
   
   ![[f1wAH-BZEdYFe6EKP5WlyA.png]]
LL型基本正常，但是HL型，尤其是HLI和HLII的温度分布有问题
- 可能是由于筛选reads使用的ani95过高，在HLI和HLII内部，解决错贴的同时也处理掉了体现丰度的reads
- 可能是由于geotrace数据库的问题，因为看到geotrace采集的24°以上样本仅60个，在整体占比中较少

### 宏泛基因组分析
[zhuanlan.zhihu.com/p/362328574](https://zhuanlan.zhihu.com/p/362328574)
[群体遗传学基础知识 - 简书](https://www.jianshu.com/p/33ab4d2c81f6)
```
1. 虽然分子进化的中性理论备受争议，但是从基因组和分子进化的一般模式来看，中性理论是没有问题的。  
2. 近年来一些新的方法发现自然选择在进化中广泛存在；  
3. 常用的方法，如贝叶斯方法、MK检验、EHH和Fst等，都存在很多问题，比如前提假设问题，模型选择问题和结果的解释问题。这些导致了研究结果中存在很多假阳性结果。  
4. 在脊椎动物中，核苷酸和氨基酸的替换数量和物种分化的时间成线性关系，这也意味着核苷酸和氨基酸替换是符合中性理论的。  
5. 几乎所有的蛋白质的进化都受到其功能限制，所以其氨基酸的替换率要比预期不受功能限制的蛋白质的氨基酸替换率低，这一现象也符合中性理论。  
```
![[Pasted image 20231105193608.png]]
正向选择：某一位点逐渐积累，成优势的位点，具体表现为：随着时间延长，该位点的突变allele频率越来越高，远远超过野生型allele；
中性选择：随着时间的延长，总体频率没有改变太多；
平衡选择：位点呈现多态性，且一直保持着平衡，
#### intrain
##### 原理
建立一套微多样性感知的基因组比较方法，并对宏基因组短读长数据程序化分析种群微多样性，通过计算以下核酸多态性，连锁不平衡，同义和非同义单核苷酸位点变异（SNV）识别，覆盖度深度和广度等指标，

1. MK检验
McDonald-Kreitman (MK)检验也是经常用来识别选择位点的方法。在该方法中，物种内非同义多态性位点PN和同义多态性位点Ps的数量比值，与物种间非同义替换的位点DN和同义替换的位点DS的数量比值做比较。如果DN/DS显著大于PN/PS，则意味着正向选择的发生。在该方法中，PN和PS均被假定为中性多态性位点，群体中一些有害的多态性位点和有益的多态性位点，在群体中被迅速清除或者固定。换言之，该方法识别的仅仅是极度有害、极度有益和中性位点。

2. Fst也是用来识别正向选择的一种方法。如果一个种群的亚群是从同一个祖先分化得来的，同时各个亚群之间的每代的迁徙率为m，按照孤岛模型，中性等位基因在这个群体中的期望Fst=
![](https://pic1.zhimg.com/80/v2-3b2a02176447641ba8e626afb360dda4_720w.webp)
，其中N表示每一个亚群的有效群体数量。

#### metapop
软件版本过老、且实际运行中出现了较多问题，故不再进行


# 原绿球藻祖先类群重建
## COUNT - 祖先基因组重建
### 原理
[Count:基因组进化分析软件介绍](https://www.sci666.com.cn/30342.html)
Count是一款进行基因家族分析的软件，该软件综合了基因进化分析中常用的方法，如Dollo和Wagner简约法（Dollo & Wagner Parsimony）、基因丢失倾向法（Propensity for Gene Loss），以及系统发育新生–消亡模型（Birth-and-Death model）的概率分析方法。它根据系统发育树分支分布的情况以及分支的长短，结合基因家族数值统计表（该表可以用OrthoFinder直接生成，或者用Excel手动整理），来推断物种祖先基因组的大小以及各个基因家族的得到、丢失、扩增、收缩情况。

1、Dollo parsimony：假设每个基因家族仅出现一次，然后用系统特异性解释存在–缺失模式；
2、Wagner parsimony：优化每个基因家族个体的得失情况，推断严谨度（penalty）的最小值；
3、posterior probabilities：通过后代（外围分支）基因组大小，计算内部节点基因家族大小的概率以重建祖先的基因组；
4、基因丢失倾向法PGL (Propensity for Gene Loss)。
### 进度
需要合理的建树，但没建完，而且geotrace的搜库丰度结果(ani95)似乎有错误

## RASP - 祖先生境重建
此软件用于分析定量性状，比较适合搜库后的祖先生境状态重建
### 原理
祖先重建常常依赖于一个足够真实的演化统计模型来准确地推断祖先状态，这些模型利用已经通过系统发育等方法获得的遗传信息来确定演化历史以及发生演化事件的时间。然而，无论模型多么接近实际的演化历史，准确重建祖先状态的能力都会随着该祖先与其后代之间的演化时间的增加而减弱。祖先重建的方法主要有三种：**最大简约法（maximum parsimony）**、**最大似然法（maximum likelihood**以及**贝叶斯法（bayesian）**。

1. 最大简约法认为所有演化事件的可能性相同
2. 最大似然法认为某些类别演化事件具有不同的可能性
3. 贝叶斯推断则将事件的条件概率与系统发育树的可能性以及与该发育树相关联的不确定性的数量联系起来。

最大简约法主要提供快速和简单的方法来推断祖先的状态，然而，由于演化过程过于简单化（例如，没有考虑分支长度和演化时间），简约法的准确性有限。

最大似然法是基于性状演化的概率模型。在各种条件下，利用理论论证和模拟研究，最大似然方法的性能优于简约法。仿真结果表明，由于考虑了进化时间和分支长度，即使是最简单的模型也能产生比简约更精确的结果，并且对系统发育的不确定性具有稳健性。

贝叶斯方法是利用马尔科夫链蒙特卡洛方法（MCMC）来推断祖先特征状态、系统发育树和模型参数的联合后验分布，这涉及到描述序列演化的复杂概率模型、分子钟、人口统计学以及研究特征的演化。由于贝叶斯方法具有丰富的选择性以及灵活性而备受欢迎，例如著名的系统发育分析软件BEAST。然而，MCMC具有较高的计算成本，对于大数据集，无法实现所有树、参数和性状分布的联合推理。

### 性状分析
a. 连续型性状（如，体重、脑重等）  
连续型性状演化模型被用来理解许多有趣的演化现象，包括：性状演化的速率，性状演化的模式，这些性状如何随着时间或谱系之间的变化以及理解导致这种变化的生物和非生物因素。

布朗运动模型（Brownian Motion models），最简单的连续性状演化模型假定性状在布朗运动模型下演化。在此模型下，沿分支预期的性状变化量为零，性状变化的方差与时间和速率参数成正比。它可以估算某性状整体的演化速率、检测演化速度随时间的变化、检测不同谱系进化速率的变化、检测与状态相关的演化速率以及检测性状相关性演化（如，性状X与性状Y在演化中是否具有相关性）。  
Ornstein-Uhlenbeck 模型主要估计演化最优值以及演化最优的变化检测。

b. 离散型性状（如，花的颜色、形状）  
对于这种性状，通常是马尔科夫链模型（Markov chain）-马尔可夫链是描述一系列可能事件的随机模型，其中每个事件的概率仅取决于在前一事件中达到的状态，在连续时间内，它被称为马尔可夫过程。

### 进度
需要建树 + 需要有意义的丰度信息